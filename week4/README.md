# 探究不同的微调数据和轮次对模型效果的影响

1. 首先利用`data/zhouyi_dataset_20240118_152413.csv`微调ChatGLM3-6B模型
   - 作业1-1：`qlora_chatglm3_timestamp.ipynb`

2. 其次利用`generate_noise_data.py`脚本生成不同数据错误（格式/标签/重复）的csv微调数据：
   - `zhouyi_format_error_30%.csv`
   - `zhouyi_label_error_30%.csv`
   - `zhouyi_repeat_30%.csv`

3. 分别利用上述数据进行微调：
   - 作业1-2：`qlora_chatglm3_timestamp_format_error.ipynb`
   - 作业1-3：`qlora_chatglm3_timestamp_label_error.ipynb`
   - 作业1-4：`qlora_chatglm3_timestamp_repeat.ipynb`

4. 检验过拟合对模型效果的影响：
   - 设置`epoch=50`进行微调
   - 作业1-5：`qlora_chatglm3_timestamp_epoch50.ipynb`

5. 比较上述微调模型在任务上的表现：
   - 作业2：`chatglm_inference.ipynb`

6. 利用豆包生成周易相关数据：
   - gen_dataset.py
   - 数据：data/zhouyi_dataset_20250825_185104.csv（注：没有使用该数据参与训练，使用的示范数据zhouyi_dataset_20240118_152413.csv）

   
# 不同微调模型输出对比总结（基于《周易》卦象问答任务）

## 一、核心对比结论
通过对**原始ChatGLM3-6B**及5类微调模型（标准数据、格式错误数据、标签错误数据、重复数据、过拟合）的输出分析，核心差异集中在**卦象准确性、内容完整性、逻辑连贯性、冗余度**四个维度：  
- 标准微调（Epoch=3, standard）显著修正原始模型错误，补充传统解卦依据；  
- 错误数据微调（格式/标签/重复）均导致输出质量下降，且问题类型与训练数据缺陷强相关；  
- 过拟合（Epoch=50）破坏卦象核心逻辑，产生无依据的错误概念。


## 二、分模型详细对比表

| 模型类型                  | 核心表现                                  | 典型问题/优势                          | 特征句子（直接取自输出）                                                                 |
|---------------------------|-------------------------------------------|---------------------------------------|------------------------------------------------------------------------------------------|
| **原始模型（Base）**      | 基础卦象认知有，但错误率高，信息碎片化    | 卦象组成错误，概念混淆                | 1. 乾卦：“由两个阴爻夹一个阳爻构成”（实际6个阳爻）；<br>2. 师卦：“为兑卦（喜悦），表示兵力强大”（师卦非兑卦） |
| **标准微调（Epoch=3, standard）** | 修正错误，补充传统解卦资源，结构清晰      | 信息完整，引入权威解读（邵雍、傅佩荣）| 1. 师卦：“据北宋易学家邵雍解，得师卦者将面临困难重重，宜包容别人；台湾国学大儒傅佩荣解提及家宅、身体影响”；<br>2. 乾卦：“由六个阳爻组成，卦辞为‘元、亨、利、贞’” |
| **格式错误微调（Epoch=3, format-error）** | 标点混乱，语句断裂，信息残缺              | 逗号/分号误用，内容不完整            | 1. 讼卦：“象数，理，核心，要，求是：天。时，地利，人和，利，利，大”；<br>2. 地水师卦：“地；大、水；流，鱼得乐时。适宜；出的；；事情有；绑住；对方” |
| **标签错误微调（Epoch=3, label-error）** | 基础定义正确，但卦象逻辑混淆              | 卦象上下卦颠倒/错配                  | 1. 讼卦：“上卦为乾（天），下卦为风”（实际下卦为坎）；<br>2. 地水师卦：直接套用“师卦由坎上承坤”的内容（未区分“师卦”与“地水师卦”） |
| **重复数据微调（Epoch=3, repeat）** | 内容高度冗余，卦象认知错误                | 语句机械重复，核心卦象描述错误        | 1. 地水师卦：连续15次重复“在事业或商业方面，地水师卦预示着吉祥如意，source.source”；<br>2. 乾卦：“由两个卦象组成，上卦是乾卦，下卦是坤卦”（实际纯乾卦） |
| **过拟合（Epoch=50）**    | 卦象逻辑完全错误，新增无关概念            | 卦象组合虚构，逻辑矛盾                | 1. 地水师卦：“上卦为乾（天），中卦为坎（水），下卦为坤（地）”（《周易》无“中卦”概念）；<br>2. 讼卦：“上卦坎（水）和下卦乾（天）”（颠倒原始“上乾下坎”卦象）；<br>3. 乾卦：“为政者应敬顺群众，富于刚强，建立权威，为政以猛为善”（无传统依据） |


## 三、关键发现提炼
1. **标准微调的价值**：仅需3轮训练（Epoch=3），即可修正原始模型的核心错误（如乾卦爻数、师卦卦象组成），并引入邵雍、傅佩荣等传统解卦资源，使输出更符合《周易》学术认知。  

2. **训练数据缺陷的“定向影响”**：  
   - 格式错误数据→输出标点混乱、语句断裂；  
   - 标签错误数据→卦象逻辑混淆（如下卦错配）；  
   - 重复数据→输出机械冗余（无意义语句循环）。  

3. **过拟合的危害**：超量训练（Epoch=50）不仅未提升效果，反而破坏模型对“卦象结构”的核心认知（如虚构“中卦”、颠倒上下卦），并新增与《周易》无关的主观概念（如“为政以猛”），逻辑连贯性显著下降。  

4. **原始模型的局限性**：对非热门卦象（如师卦）的认知混乱，易将不同卦象（如师卦与兑卦）混淆，且缺乏传统解卦的权威依据，输出碎片化。

